# Default values for aces-ml.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: sami4rhimi/aces-ml
  tag: "1.0.20"
  pullPolicy: Always

service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  protocol: TCP

# Autoscaling configuration
autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
  targetRequestsPerSecond: 100

ingress:
  enabled: true
  path: /
  pathType: Prefix
  className: webapprouting.kubernetes.azure.com
  host: aces-ml.172.189.152.57.nip.io
  annotations:
    kubernetes.azure.com/static-ip: "true"
    kubernetes.azure.com/backend-protocol: "https"
    kubernetes.azure.com/ssl-redirect: "true"
    kubernetes.azure.com/enable-caching: "true"
    kubernetes.azure.com/caching: "true"
    kubernetes.azure.com/health-probe: "true"
    kubernetes.azure.com/health-probe-path: "/health"
    kubernetes.azure.com/health-probe-interval: "30"
    kubernetes.azure.com/health-probe-timeout: "30"
    kubernetes.azure.com/health-probe-healthy-threshold: "2"
    kubernetes.azure.com/health-probe-unhealthy-threshold: "5"
    kubernetes.azure.com/health-probe-protocol: "https"
    nginx.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    kubernetes.io/ingress.class: webapprouting.kubernetes.azure.com

resources:
  limits:
    cpu: 1500m
    memory: 3Gi
  requests:
    cpu: 750m
    memory: 1.5Gi

persistence:
  model:
    enabled: true
    size: 2Gi
    accessMode: ReadWriteOnce
  dataset:
    enabled: true
    size: 1Gi
    accessMode: ReadWriteOnce

temporaryStorage:
  sizeLimit: 512Mi

env:
  - name: ML_MODEL_PATH
    value: "/app/models/random_forest_model.joblib"
  - name: DATASET_PATH
    value: "/app/data/final_dataset.csv"
  - name: MIN_SAMPLES_FOR_TRAINING
    value: "1"
  - name: BATCH_SIZE
    value: "5"
  - name: BATCH_TIMEOUT
    value: "1.0"
  - name: API_TOKEN
    valueFrom:
      secretKeyRef:
        name: aces-ml-secret
        key: api-token
  - name: LOG_LEVEL
    value: "INFO"
  - name: FLASK_ENV
    value: "production"
  - name: FLASK_APP
    value: "ML.py"
  - name: PYTHONUNBUFFERED
    value: "1"

initContainers:
  - name: init-dirs
    image: busybox
    command: ['sh', '-c', 'mkdir -p /app/data /app/models && chmod -R 777 /app/data /app/models']
    volumeMounts:
      - name: dataset-volume
        mountPath: /app/data
      - name: model-volume
        mountPath: /app/models

podAnnotations:
  checksum/config: "${RANDOM}"



